<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒì‹ í˜ˆë‹¹ ì²´í¬</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React ë¡œë“œ -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel ë¡œë“œ (JSX ë³€í™˜ìš©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* ê¸°ë³¸ í°íŠ¸ ë° ë°°ê²½ìƒ‰ ì„¤ì • */
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
        }
        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        @keyframes fade-in {
          from { opacity: 0; transform: translateY(-10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-green-50">
    <div id="root"></div>

    <script type="text/babel">
        // ê²°ê³¼ì— ë”°ë¼ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼(ìƒ‰ìƒ, ì•„ì´ì½˜)ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        const getResultStyle = (classification) => {
          switch (classification) {
            case 'ì£¼ì˜':
              return {
                bgColor: 'bg-red-100',
                textColor: 'text-red-800',
                borderColor: 'border-red-400',
                icon: 'âš ï¸',
                label: 'ì£¼ì˜'
              };
            case 'ë³´í†µ':
              return {
                bgColor: 'bg-yellow-100',
                textColor: 'text-yellow-800',
                borderColor: 'border-yellow-400',
                icon: 'ğŸ¤”',
                label: 'ë³´í†µ'
              };
            case 'ì•ˆì‹¬':
              return {
                bgColor: 'bg-green-100',
                textColor: 'text-green-800',
                borderColor: 'border-green-400',
                icon: 'âœ…',
                label: 'ì•ˆì‹¬'
              };
            default:
              return {
                bgColor: 'bg-gray-100',
                textColor: 'text-gray-800',
                borderColor: 'border-gray-300',
                icon: 'â“',
                label: 'í™•ì¸ í•„ìš”'
              };
          }
        };

        function App() {
          const [foodInput, setFoodInput] = React.useState('');
          const [results, setResults] = React.useState([]);
          const [isLoading, setIsLoading] = React.useState(false);
          const [error, setError] = React.useState(null);

          // Gemini APIë¥¼ í˜¸ì¶œí•˜ì—¬ ìŒì‹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
          const fetchFoodAnalysis = async (foodName) => {
            setIsLoading(true);
            setError(null);

            const prompt = `ë‹¹ë‡¨ë³‘ì„ ì•“ëŠ” 60ëŒ€ ì–´ë¥´ì‹ ì„ ìœ„í•´, ìŒì‹ '${foodName}'ì´ í˜ˆë‹¹ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•´ì¤˜. ì•„ì£¼ ê°„ë‹¨í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ ë‹¨ì–´ë¡œ ë‹µë³€í•´ì¤˜. ë‹µë³€ì€ ê¼­ ì•„ë˜ JSON í˜•ì‹ì— ë§ì¶°ì„œ í•´ì¤˜.

            - classification: í˜ˆë‹¹ ì˜í–¥ ì •ë„ë¥¼ 'ì•ˆì‹¬', 'ë³´í†µ', 'ì£¼ì˜' ì„¸ ê°€ì§€ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•´ì¤˜.
            - explanation: ì™œ ê·¸ë ‡ê²Œ ë¶„ë¥˜í–ˆëŠ”ì§€ 1~2 ë¬¸ì¥ìœ¼ë¡œ ì•„ì£¼ ì‰½ê²Œ ì„¤ëª…í•´ì¤˜. (ì˜ˆ: "í°ìŒ€ë°¥ì€ ì†Œí™”ê°€ ë¹¨ë¼ í˜ˆë‹¹ì„ ë¹ ë¥´ê²Œ ì˜¬ë¦´ ìˆ˜ ìˆì–´ìš”.")`;
            
            try {
              const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
              const payload = {
                contents: chatHistory,
                generationConfig: {
                  responseMimeType: "application/json",
                  responseSchema: {
                    type: "OBJECT",
                    properties: {
                      classification: { type: "STRING", enum: ["ì£¼ì˜", "ë³´í†µ", "ì•ˆì‹¬"] },
                      explanation: { type: "STRING" }
                    },
                    required: ["classification", "explanation"]
                  }
                }
              };
              
              const apiKey = ""; // API í‚¤ê°€ í•„ìš”í•˜ë©´ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”. (í˜„ì¬ëŠ” Flash ëª¨ë¸ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ë¹„ì›Œë‘¡ë‹ˆë‹¤)
              const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

              const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              
              if (!response.ok) {
                throw new Error(`API ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${response.statusText}`);
              }

              const result = await response.json();
              
              if (result.candidates && result.candidates.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                const analysis = JSON.parse(text);
                
                const newResult = {
                  id: Date.now(),
                  food: foodName,
                  ...analysis,
                };
                setResults(prev => [newResult, ...prev]);

              } else {
                throw new Error("ê²°ê³¼ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
              }

            } catch (err) {
              console.error("API í˜¸ì¶œ ì˜¤ë¥˜:", err);
              setError("ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } finally {
              setIsLoading(false);
              setFoodInput('');
            }
          };

          const handleSubmit = (e) => {
            e.preventDefault();
            if (!foodInput.trim() || isLoading) return;
            fetchFoodAnalysis(foodInput.trim());
          };

          return (
            <div className="container mx-auto max-w-lg p-4 sm:p-6 lg:p-8">
              
              <header className="text-center mb-8">
                <h1 className="text-4xl font-bold text-green-700">ìŒì‹ í˜ˆë‹¹ ì²´í¬</h1>
                <p className="text-lg text-gray-600 mt-2">ìŒì‹ì„ ì…ë ¥í•˜ë©´ í˜ˆë‹¹ ì •ë³´ë¥¼ ì•Œë ¤ë“œë ¤ìš”</p>
              </header>

              <main>
                <div className="bg-white p-6 rounded-2xl shadow-lg mb-8">
                  <form onSubmit={handleSubmit}>
                    <label htmlFor="foodInput" className="block text-xl font-semibold mb-3 text-gray-700">ê¶ê¸ˆí•œ ìŒì‹ì„ ì…ë ¥í•˜ì„¸ìš”</label>
                    <div className="flex gap-2">
                      <input
                        id="foodInput"
                        type="text"
                        value={foodInput}
                        onChange={(e) => setFoodInput(e.target.value)}
                        placeholder="ì˜ˆ) ë³´ë¦¬ë°¥, ì‚¬ê³¼, ë¼ë©´"
                        className="flex-grow w-full p-3 border-2 border-gray-200 rounded-lg text-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
                        disabled={isLoading}
                      />
                      <button 
                        type="submit" 
                        className="bg-green-600 text-white font-bold px-6 py-3 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all duration-200 disabled:bg-gray-400"
                        disabled={isLoading || !foodInput.trim()}
                      >
                        {isLoading ? 'í™•ì¸ì¤‘...' : 'í™•ì¸í•˜ê¸°'}
                      </button>
                    </div>
                  </form>
                </div>
                
                {error && <p className="text-red-500 text-center mb-4">{error}</p>}

                <div className="space-y-4">
                  {results.length === 0 && !isLoading && (
                    <p className="text-center text-gray-500 py-10 text-lg">
                      ê¶ê¸ˆí•œ ìŒì‹ì„ ì…ë ¥í•˜ê³  'í™•ì¸í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.
                    </p>
                  )}
                  {isLoading && results.length === 0 && (
                      <p className="text-center text-gray-600 py-10 text-lg animate-pulse">
                          ë˜‘ë˜‘í•œ ì¸ê³µì§€ëŠ¥ì´ ë¶„ì„í•˜ê³  ìˆì–´ìš”...
                      </p>
                  )}

                  {results.map(result => {
                    const style = getResultStyle(result.classification);
                    return (
                      <div 
                        key={result.id} 
                        className={`border-l-8 ${style.borderColor} ${style.bgColor} p-5 rounded-lg shadow-md transition-all animate-fade-in`}
                      >
                        <div className="flex items-center justify-between">
                          <h2 className="text-2xl font-bold text-gray-800">{result.food}</h2>
                          <span className={`px-4 py-1 text-lg font-bold ${style.textColor} ${style.bgColor} border-2 ${style.borderColor} rounded-full`}>
                            {style.icon} {style.label}
                          </span>
                        </div>
                        <p className={`mt-2 text-lg ${style.textColor}`}>
                          {result.explanation}
                        </p>
                      </div>
                    );
                  })}
                </div>
              </main>
              
            </div>
          );
        }

        const domContainer = document.querySelector('#root');
        const root = ReactDOM.createRoot(domContainer);
        root.render(<App />);

    </script>
</body>
</html>
